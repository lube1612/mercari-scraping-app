# スプレッドシート連携システム - 方法まとめ

## 📋 概要

スプレッドシートに条件を入力して、実行ボタンを押したらスクレイピングが実行されるシステムを作成する方法をまとめます。

## 🎯 実装方法の比較

### 方法1: Streamlitアプリケーション（推奨）⭐

**特徴:**
- ✅ Pythonベースで簡単に実装できる
- ✅ スプレッドシート風のUI
- ✅ 実行ボタンでワンクリック実行
- ✅ 結果をテーブル形式で表示
- ✅ CSVダウンロード機能

**デメリット:**
- Webアプリケーションの起動が必要
- ローカル環境での実行

**実行方法:**
```bash
streamlit run streamlit_app.py
```

**詳細:** `Streamlitアプリ_実行手順.md` を参照

---

### 方法2: Googleスプレッドシート + Google Apps Script

**特徴:**
- ✅ Googleスプレッドシートから直接実行
- ✅ クラウドベース
- ✅ 複数人で共有可能

**デメリット:**
- ❌ Google Apps Scriptから直接Pythonスクリプトを実行できない
- ❌ 外部API経由で実行する必要がある
- ❌ セットアップが複雑

**実装方法:**
1. Google Cloud FunctionsでPythonスクリプトをデプロイ
2. Google Apps ScriptからAPIを呼び出す
3. 結果をスプレッドシートに書き込む

**詳細:** `google_sheets_apps_script.js` を参照（参考コード）

---

### 方法3: Excel + VBAマクロ

**特徴:**
- ✅ Excelから直接実行
- ✅ ローカル環境で動作

**デメリット:**
- ❌ VBAからPythonスクリプトを実行する必要がある
- ❌ Windows環境が前提
- ❌ セットアップが複雑

**実装方法:**
1. VBAマクロでPythonスクリプトを実行
2. 結果をExcelに書き込む

---

## 🚀 推奨: Streamlitアプリケーション

### セットアップ手順

1. **Streamlitのインストール**
   ```bash
   pip3 install streamlit pandas
   ```

2. **アプリケーションの起動**
   ```bash
   cd /Users/shimadaeiji/Documents/Cursor/e2e
   export PLAYWRIGHT_BROWSERS_PATH=~/playwright-browsers
   streamlit run streamlit_app.py
   ```

3. **ブラウザで開く**
   - 自動的にブラウザが開きます
   - URL: `http://localhost:8501`

### 使い方

1. **左側のサイドバーで設定**
   - 検索キーワードを入力
   - 取得件数を設定
   - Amazon比較の有効/無効を選択

2. **「スクレイピング実行」ボタンをクリック**
   - 実行中はプログレスバーが表示されます
   - 完了すると結果が表示されます

3. **結果の確認とダウンロード**
   - 取得した商品情報がテーブル形式で表示されます
   - 「CSVファイルをダウンロード」ボタンでCSVファイルをダウンロードできます

## 📊 Streamlitアプリの機能

### 主な機能

1. **条件入力フォーム**
   - 検索キーワード
   - 取得件数（1-20件）
   - Amazon比較の有効/無効

2. **実行ボタン**
   - ワンクリックでスクレイピング実行
   - プログレスバーで進捗表示

3. **結果表示**
   - テーブル形式で結果を表示
   - CSVダウンロード機能

4. **履歴表示**
   - 過去の実行結果を確認
   - 過去のCSVファイルをダウンロード

## 🔧 カスタマイズ

### 追加の入力フィールドを追加する場合

`streamlit_app.py` に以下を追加：

```python
min_price = st.number_input(
    "最低価格",
    min_value=0,
    value=0,
    help="最低価格を設定"
)

max_price = st.number_input(
    "最高価格",
    min_value=0,
    value=10000,
    help="最高価格を設定"
)
```

### 結果の表示をカスタマイズする場合

`streamlit_app.py` の結果表示部分を編集：

```python
# グラフを追加
import plotly.express as px

if 'price' in df.columns:
    fig = px.histogram(df, x='price', title='価格分布')
    st.plotly_chart(fig)
```

## 🌐 デプロイ（オプション）

### Streamlit Cloudにデプロイ

1. GitHubにリポジトリをプッシュ
2. [Streamlit Cloud](https://streamlit.io/cloud) にサインアップ
3. リポジトリを接続してデプロイ

### Herokuにデプロイ

1. `Procfile` を作成
2. Herokuにデプロイ

## 📝 まとめ

**最も簡単で実用的な方法は Streamlitアプリケーションです。**

- ✅ セットアップが簡単
- ✅ スプレッドシート風のUI
- ✅ 実行ボタンでワンクリック実行
- ✅ 結果の表示とダウンロードが簡単

詳細は `Streamlitアプリ_実行手順.md` を参照してください。
