# Amazonとメルカリの価格比較スクレイピング

## 📋 概要

Amazonとメルカリのポケモンカードの価格を比較して、Amazonより安い商品を5つ厳選して取得します。

## 🚀 実行方法

**Cursorのターミナルで以下のコマンドを実行してください：**

```bash
cd /Users/shimadaeiji/Documents/Cursor/e2e
export PLAYWRIGHT_BROWSERS_PATH=~/playwright-browsers
python3 compare_prices.py
```

## 📋 実行時の動作

1. **メルカリから商品情報を取得**
   - 検索キーワード: "ポケモンカード"
   - 最大10件の商品情報を取得

2. **Amazonから商品情報を取得**
   - 検索キーワード: "ポケモンカード"
   - 最大10件の商品情報を取得

3. **価格を比較**
   - タイトルでマッチング（共通キーワードで判定）
   - Amazonより安い商品を選出
   - 価格差が大きい順にソート

4. **結果を保存**
   - CSVファイルに保存: `mercari/output/cheaper_items.csv`
   - Amazonより安い商品を最大5件保存

## 📊 CSVファイルの内容

以下の情報が保存されます：
- `title`: 商品タイトル
- `price`: メルカリの価格
- `amazon_price`: Amazonの価格
- `price_difference`: 価格差
- `amazon_url`: Amazonの商品URL
- `url`: メルカリの商品URL

## ⚠️ 注意事項

1. **実行時間**: 約5-10分かかる場合があります（両サイトから商品情報を取得するため）

2. **ブラウザ表示**: `headless=False` で実行されるため、ブラウザウィンドウが表示されます

3. **マッチング精度**: タイトルのキーワードマッチングで比較するため、完全に同じ商品とは限りません

4. **Amazonのサイト構造**: Amazonのサイト構造が変更された場合、セレクタの調整が必要な場合があります

## 🔧 トラブルシューティング

### 問題1: Amazonの商品リンクが見つからない

**解決方法:**
- Amazonのサイト構造が変更されている可能性があります
- `amazon/scraper.py` のセレクタを確認・修正してください

### 問題2: 価格が取得できない

**解決方法:**
- Amazonの価格表示形式が変更されている可能性があります
- `amazon/scraper.py` の価格取得セレクタを確認・修正してください

### 問題3: マッチングがうまくいかない

**解決方法:**
- `compare_prices.py` の `compare_and_select_cheaper_items` 関数のマッチングロジックを調整してください
- 共通キーワードの閾値を変更できます

## 📝 カスタマイズ

### 取得件数を変更する場合

`compare_prices.py` の以下の部分を変更：

```python
cheaper_items = compare_and_select_cheaper_items(mercari_items, amazon_items, max_items=5)
```

### 検索キーワードを変更する場合

`compare_prices.py` の以下の部分を変更：

```python
search_keyword = "ポケモンカード"
```

## 🎯 実行例

```bash
$ python3 compare_prices.py
============================================================
Amazonとメルカリの価格比較スクレイピング
============================================================
検索キーワード: ポケモンカード
取得件数: 5件（Amazonより安い商品）

============================================================
1. メルカリから商品情報を取得中...
============================================================
...
（メルカリの商品情報取得）

============================================================
2. Amazonから商品情報を取得中...
============================================================
...
（Amazonの商品情報取得）

============================================================
3. 価格を比較中...
============================================================

============================================================
取得結果
============================================================
取得件数: 5件
CSVファイル: mercari/output/cheaper_items.csv

Amazonより安い商品:
  1. ラティアス&ラティオス GX RR SM9...
     メルカリ: ¥400 | Amazon: ¥600 | 差額: ¥200
  ...
```
