# Playwrightブラウザインストール - 最終解決方法

## 🔍 問題の原因

調査の結果、以下の問題が判明しました：

1. **chromium-1200ディレクトリは存在するが、中身が空**
   - ディレクトリは作成されているが、実行ファイルが配置されていない

2. **手動ダウンロードが失敗**
   - ZIPファイルが24バイトしかダウンロードされない
   - `GatewayExceptionResponse`エラーが発生
   - SSL証明書の問題の可能性

3. **必要なファイルが不足**
   - `chromium_headless_shell-1200`も必要だが、これも見つからない

## ✅ 確実な解決方法

### 方法1: Playwrightの公式インストールコマンド（推奨）

**この方法が最も確実です。**

**Cursorのターミナルで以下のコマンドを実行：**

```bash
python3 -m playwright install chromium
```

このコマンドが：
- 正しいバージョンのブラウザを自動ダウンロード
- 必要なすべてのファイルを正しい場所に配置
- SSL証明書の問題を回避
- エラーハンドリングが充実

### 方法2: すべてのブラウザをインストール

**より確実にインストールする場合：**

```bash
python3 -m playwright install
```

これで、Chromium、Firefox、WebKitがすべてインストールされます。

## 📋 実行手順

### ステップ1: 既存の不完全なインストールを削除（オプション）

**既存の空のディレクトリを削除して、クリーンな状態から始める場合：**

```bash
rm -rf ~/Library/Caches/ms-playwright/chromium-1200
rm -rf ~/Library/Caches/ms-playwright/chromium_headless_shell-1200
```

**注意**: このステップはオプションです。公式コマンドが自動的に上書きします。

### ステップ2: 公式コマンドでインストール

```bash
python3 -m playwright install chromium
```

**実行時の注意：**
- インターネット接続が必要です
- 約150-200MBのダウンロードがあります
- 数分かかる場合があります
- 進捗が表示されます

### ステップ3: インストール確認

```bash
python3 -c "from playwright.sync_api import sync_playwright; p = sync_playwright().start(); browser = p.chromium.launch(headless=True); print('✓ ブラウザの起動に成功しました！'); browser.close(); p.stop()"
```

**成功した場合**: 次のステップに進んでください。

**失敗した場合**: トラブルシューティングセクションを参照してください。

### ステップ4: スクレイピングを開始

```bash
python3 mercari/scrape.py
```

## 🔧 トラブルシューティング

### 問題1: ネットワークエラーが発生する

**解決方法：**

1. **インターネット接続を確認**
   ```bash
   ping playwright.azureedge.net
   ```

2. **ファイアウォールの設定を確認**
   - 企業ネットワークの場合、管理者に相談

3. **プロキシを使用している場合**
   ```bash
   HTTPS_PROXY=https://プロキシのアドレス:ポート python3 -m playwright install chromium
   ```

### 問題2: 権限エラーが発生する

**解決方法：**

```bash
# ディレクトリの権限を確認
ls -la ~/Library/Caches/ms-playwright/

# 必要に応じて権限を変更
chmod -R 755 ~/Library/Caches/ms-playwright/
```

### 問題3: インストールが途中で止まる

**解決方法：**

1. ターミナルで `Ctrl + C` で中断
2. 以下を実行して再試行：
   ```bash
   python3 -m playwright install chromium
   ```

### 問題4: SSL証明書エラーが発生する

**解決方法：**

1. **macOSのSSL証明書を更新**
   ```bash
   # 証明書を更新（管理者権限が必要な場合があります）
   sudo security find-certificate -a -p | sudo tee /etc/ssl/cert.pem
   ```

2. **または、一時的にSSL検証をスキップ（開発環境のみ）**
   ```bash
   export PYTHONHTTPSVERIFY=0
   python3 -m playwright install chromium
   ```

## 📊 なぜ公式コマンドが推奨されるのか

1. **自動バージョン管理**
   - Playwrightのバージョンとブラウザのバージョンが自動的に一致

2. **正しい配置**
   - 必要なすべてのファイルを正しい場所に配置

3. **エラーハンドリング**
   - ネットワークエラー、権限エラーなどを適切に処理

4. **メンテナンスが簡単**
   - アップデート時も同じコマンドで対応可能

5. **SSL証明書の問題を回避**
   - Playwrightの内部処理でSSL証明書の問題を回避

## 🎯 まとめ

**最も確実な方法（1つのコマンド）：**

```bash
python3 -m playwright install chromium
```

このコマンドを実行すれば、すべてが自動的に設定されます。

**手動ダウンロードは避ける：**
- サーバー側の問題で失敗しやすい
- SSL証明書の問題が発生しやすい
- バージョンの不一致が発生しやすい
